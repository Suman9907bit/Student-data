<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DFIT Student Management Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
:root{
  --primary:#0b3c8a;
  --secondary:#f4f7fb;
  --white:#fff;
}
*{box-sizing:border-box;font-family:Segoe UI}
body{margin:0;background:var(--secondary)}

.header{
  background:var(--primary);
  color:#fff;
  padding:15px 25px;
  font-size:20px;
  font-weight:600;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.wrapper{padding:20px}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  margin-bottom:20px;
}

.card{
  background:var(--white);
  padding:20px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.08);
}

.card h3{margin:0;font-size:16px;color:#555}
.card h2{margin:10px 0 0;color:var(--primary)}

.filters{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:10px;
  margin-bottom:15px;
}

.filters input,.filters select{
  padding:10px;
  border:1px solid #ccc;
  border-radius:6px;
}

.actions{margin-bottom:15px}

.actions button{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
  margin-right:8px;
}

.table-box{
  background:#fff;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.08);
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:900px;
}

th,td{
  padding:10px;
  border-bottom:1px solid #eee;
}

th{background:#eef3fb}

tr:hover{background:#f5f9ff}

.footer{
  text-align:center;
  padding:15px;
  font-size:13px;
  color:#666;
}
</style>
</head>

<body>

<div class="header">
  <div><i class="fa-solid fa-graduation-cap"></i> DFIT Student Management</div>
  <div>Live Admin Panel</div>
</div>

<div class="wrapper">

<div class="cards">
  <div class="card">
    <h3>Total Students</h3>
    <h2 id="totalCount">0</h2>
  </div>
  <div class="card">
    <h3>Diploma</h3>
    <h2 id="diplomaCount">0</h2>
  </div>
  <div class="card">
    <h3>Basic</h3>
    <h2 id="basicCount">0</h2>
  </div>
  <div class="card">
    <h3>Advance Diploma</h3>
    <h2 id="advanceCount">0</h2>
  </div>
</div>

<div class="filters">
  <input type="text" id="nameFilter" placeholder="Search Name">
  <select id="courseFilter">
    <option value="">All Courses</option>
    <option>Basic</option>
    <option>Diploma</option>
    <option>Advance Diploma</option>
    <option>Tally</option>
  </select>
  <input type="date" id="dateFilter">
  <input type="number" id="dayFilter" placeholder="Live Day ≥">
</div>

<div class="actions">
  <button onclick="exportExcel()"><i class="fa-solid fa-file-excel"></i> Excel</button>
  <button onclick="exportPDF()"><i class="fa-solid fa-file-pdf"></i> PDF</button>
</div>

<div class="table-box">
<table id="studentTable">
<thead>
<tr>
<th>SL</th>
<th>Name</th>
<th>Roll</th>
<th>Mobile</th>
<th>Father</th>
<th>Date</th>
<th>Course</th>
<th>Live Day</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<div class="footer">
© 2026 Digital Future Information Technology
</div>

<script>

const sheetURL = "https://script.google.com/macros/s/AKfycbwjCJQ8Et9krH_XESIqXV7589-hTqdws5jOwlHxh3-QPrXjSosoZaqjYjlCHvTQnhc/exec";

function liveDay(date){
  if(!date) return 0;
  const d1=new Date(date);
  const d2=new Date();
  return Math.floor((d2-d1)/(1000*60*60*24));
}

async function loadTable(){
  try{
    const response = await fetch(sheetURL);
    const students = await response.json();

    const tbody=document.querySelector("#studentTable tbody");
    tbody.innerHTML="";

    let diploma=0,basic=0,advance=0;

    students.forEach((s,index)=>{
      const day=liveDay(s.Date);

      if(s.Course==="Diploma") diploma++;
      if(s.Course==="Basic") basic++;
      if(s.Course==="Advance Diploma") advance++;

      tbody.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${s.SL || index+1}</td>
        <td>${s.Name || ""}</td>
        <td>${s.Roll || ""}</td>
        <td>${s.Mobile || ""}</td>
        <td>${s.Father || ""}</td>
        <td>${s.Date || ""}</td>
        <td>${s.Course || ""}</td>
        <td>${day}</td>
      </tr>`);
    });

    document.getElementById("totalCount").innerText=students.length;
    document.getElementById("diplomaCount").innerText=diploma;
    document.getElementById("basicCount").innerText=basic;
    document.getElementById("advanceCount").innerText=advance;

  }catch(error){
    alert("Data load failed");
    console.error(error);
  }
}

loadTable();

document.querySelectorAll(".filters input,.filters select")
.forEach(el=>el.addEventListener("input",()=>{
  const nameF=nameFilter.value.toLowerCase();
  const courseF=courseFilter.value;
  const dateF=dateFilter.value;
  const dayF=dayFilter.value;

  document.querySelectorAll("#studentTable tbody tr").forEach(r=>{
    const name=r.children[1].innerText.toLowerCase();
    const course=r.children[6].innerText;
    const date=r.children[5].innerText;
    const day=parseInt(r.children[7].innerText);

    r.style.display=
      (name.includes(nameF)) &&
      (!courseF || course===courseF) &&
      (!dateF || date===dateF) &&
      (!dayF || day>=dayF)
      ? "" : "none";
  });
}));

function exportExcel(){
  const wb=XLSX.utils.table_to_book(document.getElementById("studentTable"));
  XLSX.writeFile(wb,"student_data.xlsx");
}

function exportPDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.text("DFIT Student Data",14,10);
  doc.autoTable({html:"#studentTable",startY:15});
  doc.save("student_data.pdf");
}

</script>

</body>
</html>
